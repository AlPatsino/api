# Платформа откликов

## Введение

Платформа откликов нужна для обеспечения удобной интеграции карьерного сайта клиента с Хантфлоу.

Это достигается путем предоставления типизированных методов API карьерного сайта клиента, которые платформа использует для публикации вакансий и сбора откликов. При этом достигается минимальная связность карьерного сайта с внешней ATS (потребителем методов API может быть любой другой сервис).

Подразумевается, что карьерный сайт будет иметь token-based или HTTP-Basic аутентификацию, а также весь обмен будет проходить по защищенному каналу (HTTPS).

## Обработка ошибок

Положительным результатом запроса считается код ответа 200 или 204, а также тело ответа в соответствии с ожидаемым результатом.

Любые другие коды ответов обрабатываются как ошибки. При этом, помимо кода ответа, в теле ответа ожидается дополнительная информация, позволяющая понять причину ошибки в формате:
 
```json
{
    "errors": {
        "common": [
          "Some common error that not related to a specific request field"
        ],
        "position": [
          "Vacancy position is a required field"
        ]
    }
}
```

## Перечень методов

* [Публикация вакансии](#publication)
* [Редактирование вакансии](#edit)
* [Снятие вакансии с публикации](#unpublish)


<a name="publication"></a>
## Публикация вакансии

`POST /publish`

В теле запроса будет передан JSON вида:

```json
{
    "position": "Python developer",
    "body": "<p>Пишу я вам, чего же <strong>боле</strong></p>",
    "requirements": "<p>Что я могу ещё <strong>сказать</strong></p>",
    "conditions": "<p>Теперь я знаю в вашей воле <strong>воле</strong></p>",
    "some_dictionary": {
      "name": "Отдел разработки",
      "foreign": "external_id"
    }
}
```

Полный набор передаваемых данных обсуждается при внедрении и зависит от требований клиента.

Ожидаемый ответ – идентификатор созданной вакансии на карьерном сайте:

```json
{
    "id": 1
}
```

Далее этот идентификатор будет использоваться для редактирования, снятия с публикации и получения откликов.


<a name="edit"></a>
## Редактирование вакансии

`PUT /vacancy/{vacancy_id}`

где `{vacancy_id}` – идентификатор вакансии на карьерном сайте, полученный ранее при публикации.

В теле запроса будет передан JSON вида (аналогичный публикации):

```json
{
    "position": "Python developer",
    "body": "<p>Пишу я вам, чего же <strong>боле</strong></p>",
    "requirements": "<p>Что я могу ещё <strong>сказать</strong></p>",
    "conditions": "<p>Теперь я знаю в вашей воле <strong>воле</strong></p>",
    "some_dictionary": {
      "name": "Отдел разработки",
      "foreign": "external_id"
    }
}
```

Ожидаемый ответ: HTTP-код 200 или 204. Тело ответа игнорируется.

<a name="unpublish"></a>
## Снятие вакансии с публикации

`DELETE /vacancy/{vacancy_id}`

где `{vacancy_id}` – идентификатор вакансии на карьерном сайте, полученный ранее при публикации.

Ожидаемый ответ: HTTP-код 200 или 204. Тело ответа игнорируется.


<a name="responses"></a>
## Получение откликов по вакансии

`GET /vacancy/{vacancy_id}/response`

где `{vacancy_id}` – идентификатор вакансии на карьерном сайте, полученный ранее при публикации.

Подразумевается, что сортировка откликов идет по убыванию даты отклика (более новые отклики находятся в начале списка). Это позволяет оптимизировать запросы к API со сторны Хантфлоу.

Ожидаемый ответ:

```json
{
  "items": [
    {
      "id": 2,
      "first_name": "Иван",
      "last_name": "Иванов",
      "middle_name": "Иванович",
      "phone": "89261234444",
      "email": "test@example.com",
      "created": "2018-12-20T18:00:00Z",
      "resume": [
        {
          "files": [
              {
                "name": "Резюме.pdf",
                "url": "https://someexternalurl.ru/uploads/resume.pdf"
              }
          ],
          "data": {
            "body": "Дополнительный текст резюме"
          }
        }
      ]
    },
    {
      "id": 1,
      "first_name": "Петр",
      "last_name": "Петров",
      "middle_name": "Петрович",
      "phone": "89261232222",
      "email": "resp@example.com",
      "created": "2018-12-19T18:00:00Z",
      "resume": [
        {
          "files": [
            {
              "name": "Петров_резюме.pdf",
              "url": "https://someexternalurl.ru/uploads/petrov.pdf"
            }
          ],
          "data": {
            "body": "Дополнительный текст резюме"
          }
        }
      ]
    }
  ],
  "page": 1,
  "pages": 3,
  "per_page": 20,
  "found": 55
}
```

### Поля ответа элемента items

* `[]` обозначает, что значение данного ключа является массивом
* `a.b` обозначает объект `a` с ключом `b`

Путь | Тип | Обязательный | Описание
---- | -------- | ------------ | --------
id | number|string | Да | Идентификатор отклика
last_name | string | Да | Фамилия
first_name | string | Да | Имя
middle_name | string | Нет | Отчество
phone | string | Нет | Телефон
email | string | Нет | Электронная почта
created | datetime | Да | Дата и время отклика
resume.files | array | Нет | Массив файлов с резюме
resume.files[].name | string | Нет | Название файла с резюме
resume.files[].url | string | Да | Ссылка на файл с резюме
resume.data.body | string | Нет | Дополнительный текст резюме


<a name="responses-logs"></a>
## Получение сопроводительных писем по отклику

`GET /vacancy/{vacancy_id}/response/{response_id}`

где `{vacancy_id}` – идентификатор вакансии на карьерном сайте, `{response_id}` – идентификатор отклика

Ожидаемый ответ:

```json
{
  "items": [
      {
        "id": 2,
        "type": "recommendation",
        "comment": "Хороший кандидат, нужно брать",
        "created": "2018-12-21T18:00:00Z",
        "author": {
          "name": "Сергей Иванов",
          "email": "rec@mail.com"
        }
      },
      {
        "id": 1,
        "type": "response",
        "comment": "Хочу у вас работать!",
        "created": "2018-12-20T18:00:00Z"
      }      
    ],
    "page": 1,
    "pages": 1,
    "per_page": 20,
    "found": 2
}
```

### Поля ответа элемента items

* `[]` обозначает, что значение данного ключа является массивом
* `a.b` обозначает объект `a` с ключом `b`

Путь | Тип | Обязательный | Описание
---- | -------- | ------------ | --------
id | number|string | Да | Идентификатор
type | string | Да | Тип комментария (`recommendation` – рекомендация, `response` – сопроводительное письмо)
comment | string | Да | Текст сопроводительного письма/рекомендация 
created | datetime | Нет | Дата и время сообщения (если не передается, то берется время на момент синхронизации)
author | object | Нет | Автор рекомендации (используется для типа `recommendation`)
author.name | string | Да | Имя рекомендателя
author.email | string | Нет | Адрес почты рекомендателя
